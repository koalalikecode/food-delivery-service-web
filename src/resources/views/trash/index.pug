extends ../layout/main.pug

block trash_nav 
    a(href='/trash' class='flex items-center gap-1 px-8 py-2 relative bg-light-purple text-strong-purple before:absolute before:top-0 before:left-0 before:w-1 before:h-full before:bg-strong-purple')
        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
        </svg>
        span Trash
block content 
    div(class='max-w-4xl m-auto bg-white mt-10 border rounded-xl')
        div(class='p-4 flex justify-between items-center')
            h3(class='text-2xl font-bold') Deleted Customers 
            div(class='flex gap-4')
                form(class='text-dark-grey relative mb-0')
                    <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5 absolute left-2 top-1/2 -translate-y-1/2">
                        <path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z" />
                    </svg>
                    input(type="text" placeholder="Search customer here" name='customerSearch' value=`${customerSearch}` class="pl-8 py-2 w-80 border text-black placeholder:text-dark-grey focus:outline-none focus:border focus:border-strong-purple rounded-md")       
        div(class='max-h-[75vh] overflow-auto purple-scrollbar')     
            table(class='table-auto w-full text-left leading-9')
                thead(class="border-b border-gray-300 bg-[#F6F6F6] text-dark-grey")
                    tr
                        th(class='pl-4') Customer ID 
                        th Name 
                        th Phone Number 
                        th Address
                        th Rank
                        th Action
                tbody
                    each customer in customers 
                        tr(class="border-b border-gray-300")
                            td(class='pl-4')= customer.CustomerID 
                            td= customer.name
                            td= customer.PhoneNumber
                            td= customer.Address
                            td= customer.rank_member
                            td 
                                div(class="flex gap-1")
                                    a(data-modal-target="restore-popup-modal" 
                                    data-modal-toggle="restore-popup-modal" data-id=`${customer.CustomerNum}`  class='restore-customer-btn hover:bg-gray-300 cursor-pointer rounded-full p-0.5 text-blue-400')
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M7.875 14.25l1.214 1.942a2.25 2.25 0 001.908 1.058h2.006c.776 0 1.497-.4 1.908-1.058l1.214-1.942M2.41 9h4.636a2.25 2.25 0 011.872 1.002l.164.246a2.25 2.25 0 001.872 1.002h2.092a2.25 2.25 0 001.872-1.002l.164-.246A2.25 2.25 0 0116.954 9h4.636M2.41 9a2.25 2.25 0 00-.16.832V12a2.25 2.25 0 002.25 2.25h15A2.25 2.25 0 0021.75 12V9.832c0-.287-.055-.57-.16-.832M2.41 9a2.25 2.25 0 01.382-.632l3.285-3.832a2.25 2.25 0 011.708-.786h8.43c.657 0 1.281.287 1.709.786l3.284 3.832c.163.19.291.404.382.632M4.5 20.25h15A2.25 2.25 0 0021.75 18v-2.625c0-.621-.504-1.125-1.125-1.125H3.375c-.621 0-1.125.504-1.125 1.125V18a2.25 2.25 0 002.25 2.25z" />
                                        </svg>
                                    a(data-modal-target="delete-popup-modal" 
                                    data-modal-toggle="delete-popup-modal" data-id=`${customer.CustomerNum}` class='delete-customer-btn hover:bg-gray-300 cursor-pointer rounded-full p-0.5 text-red-500')
                                        <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                                            <path stroke-linecap="round" stroke-linejoin="round" d="M14.74 9l-.346 9m-4.788 0L9.26 9m9.968-3.21c.342.052.682.107 1.022.166m-1.022-.165L18.16 19.673a2.25 2.25 0 01-2.244 2.077H8.084a2.25 2.25 0 01-2.244-2.077L4.772 5.79m14.456 0a48.108 48.108 0 00-3.478-.397m-12 .562c.34-.059.68-.114 1.022-.165m0 0a48.11 48.11 0 013.478-.397m7.5 0v-.916c0-1.18-.91-2.164-2.09-2.201a51.964 51.964 0 00-3.32 0c-1.18.037-2.09 1.022-2.09 2.201v.916m7.5 0a48.667 48.667 0 00-7.5 0" />
                                        </svg>


    #delete-popup-modal.fixed.top-0.left-0.right-0.z-50.hidden.p-4.overflow-x-hidden.overflow-y-auto.h-modal(tabindex='-1' class='md:inset-0 md:h-full')
        .relative.w-full.h-full.max-w-md(class='md:h-auto')
            .relative.bg-white.rounded-lg.shadow(class='dark:bg-gray-700')
                button.absolute.top-3.text-gray-400.bg-transparent.rounded-lg.text-sm.ml-auto.inline-flex.items-center(type='button' class='right-2.5 hover:bg-gray-200 hover:text-gray-900 p-1.5 dark:hover:bg-gray-800 dark:hover:text-white' data-modal-hide='delete-popup-modal')
                    svg.w-5.h-5(aria-hidden='true' fill='currentColor' viewbox='0 0 20 20' xmlns='http://www.w3.org/2000/svg')
                        path(fill-rule='evenodd' d='M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z' clip-rule='evenodd')
                    span.sr-only Close modal
                .p-6.text-center
                    svg.mx-auto.mb-4.text-gray-400.w-14.h-14(aria-hidden='true' class='dark:text-gray-200' fill='none' stroke='currentColor' viewbox='0 0 24 24' xmlns='http://www.w3.org/2000/svg')
                        path(stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z')
                    h3.mb-5.text-lg.font-normal.text-gray-500(class='dark:text-gray-400') Are you sure you want to delete this customer permanently?
                    button.text-white.bg-red-600.font-medium.rounded-lg.text-sm.inline-flex.items-center.px-5.text-center.mr-2(data-modal-hide='delete-popup-modal' type='button' id='sure-delete-btn' class='hover:bg-red-800 focus:ring-4 focus:outline-none focus:ring-red-300 dark:focus:ring-red-800 py-2.5')
                        | Yes, I'm sure
                    button.text-gray-500.bg-white.rounded-lg.border.border-gray-200.text-sm.font-medium.px-5(data-modal-hide='delete-popup-modal' type='button' class='hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600') No, cancel
    form(name="delete-customer-form" method="POST")

    #restore-popup-modal.fixed.top-0.left-0.right-0.z-50.hidden.p-4.overflow-x-hidden.overflow-y-auto.h-modal(tabindex='-1' class='md:inset-0 md:h-full')
        .relative.w-full.h-full.max-w-md(class='md:h-auto')
            .relative.bg-white.rounded-lg.shadow(class='dark:bg-gray-700')
                button.absolute.top-3.text-gray-400.bg-transparent.rounded-lg.text-sm.ml-auto.inline-flex.items-center(type='button' class='right-2.5 hover:bg-gray-200 hover:text-gray-900 p-1.5 dark:hover:bg-gray-800 dark:hover:text-white' data-modal-hide='restore-popup-modal')
                    svg.w-5.h-5(aria-hidden='true' fill='currentColor' viewbox='0 0 20 20' xmlns='http://www.w3.org/2000/svg')
                        path(fill-rule='evenodd' d='M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z' clip-rule='evenodd')
                    span.sr-only Close modal
                .p-6.text-center
                    svg.mx-auto.mb-4.text-gray-400.w-14.h-14(aria-hidden='true' class='dark:text-gray-200' fill='none' stroke='currentColor' viewbox='0 0 24 24' xmlns='http://www.w3.org/2000/svg')
                        path(stroke-linecap="round" stroke-linejoin="round" stroke-width='2' d="M9 12.75l3 3m0 0l3-3m-3 3v-7.5M21 12a9 9 0 11-18 0 9 9 0 0118 0z")
                    h3.mb-5.text-lg.font-normal.text-gray-500(class='dark:text-gray-400') Are you sure you want to restore this customer?
                    button.text-white.bg-blue-600.font-medium.rounded-lg.text-sm.inline-flex.items-center.px-5.text-center.mr-2(data-modal-hide='restore-popup-modal' type='button' id='sure-restore-btn' class='hover:bg-blue-800 focus:ring-4 focus:outline-none focus:ring-blue-300 dark:focus:ring-blue-800 py-2.5')
                        | Yes, I'm sure
                    button.text-gray-500.bg-white.rounded-lg.border.border-gray-200.text-sm.font-medium.px-5(data-modal-hide='restore-popup-modal' type='button' class='hover:bg-gray-100 focus:ring-4 focus:outline-none focus:ring-gray-200 py-2.5 hover:text-gray-900 focus:z-10 dark:bg-gray-700 dark:text-gray-300 dark:border-gray-500 dark:hover:text-white dark:hover:bg-gray-600 dark:focus:ring-gray-600') No, cancel
    form(name="restore-customer-form" method="POST")
    script.
        document.addEventListener("DOMContentLoaded", function() {

            let customerID;
            let deleteCustomerForm = document.forms['delete-customer-form'];
            let deleteCustomerBtn = document.getElementById('sure-delete-btn')

            let restoreCustomerForm = document.forms['restore-customer-form'];
            let restoreCustomerBtn = document.getElementById('sure-restore-btn')

            $(".delete-customer-btn").on("click", function() {
                customerID = this.getAttribute("data-id");
            })

            $(".restore-customer-btn").on("click", function() {
                customerID = this.getAttribute("data-id");
            })
            deleteCustomerBtn.onclick = function () {
                deleteCustomerForm.action = '/trash/customer/delete/' + customerID + '?_method=DELETE'
                deleteCustomerForm.submit();
            }

            restoreCustomerBtn.onclick = function () {
                restoreCustomerForm.action = '/trash/customer/restore/' + customerID
                restoreCustomerForm.submit();
            }

        })





